# ai_client.py
import os
import requests
from typing import Optional

# –ó–∞–≥—Ä—É–∂–∞–µ–º API-–∫–ª—é—á (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ DeepSeek —á–µ—Ä–µ–∑ HTTP-—ç–Ω–¥–ø–æ–∏–Ω—Ç)
DEEPSEEK_API_KEY = os.getenv("DEEPSEEK_API_KEY")

# –ü—Ä–∏–º–µ—Ä –¥–ª—è –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ DeepSeek API (–µ—Å–ª–∏ —É –≤–∞—Å —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä ‚Äî –∑–∞–º–µ–Ω–∏—Ç–µ URL)
DEEPSEEK_API_URL = "https://api.deepseek.com/v1/chat/completions"  # ‚Üê –ü–†–ò–ú–ï–†! –£—Ç–æ—á–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π URL

async def get_ai_response(user_prompt: str, context: str = "") -> str:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ DeepSeek –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç.
    –ü–æ–∫–∞ ‚Äî –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤.
    """
    # üîÅ –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ DeepSeek!
    if not DEEPSEEK_API_KEY:
        return (
            "üßô‚Äç‚ôÇÔ∏è *–ì–æ–ª–æ—Å –¥—Ä–µ–≤–Ω–µ–≥–æ –º—É–¥—Ä–µ—Ü–∞ –∑–≤—É—á–∏—Ç —ç—Ö–æ–º:*\n"
            "\"–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è... –¢—É–º–∞–Ω –∫–ª—É–±–∏—Ç—Å—è –≤–æ–∫—Ä—É–≥ —Ç–µ–±—è. "
            "–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π ‚Äî —Ç—Ä–∏ –ø—É—Ç–∏: –≤ –ª–µ—Å, –≤ –ø–µ—â–µ—Ä—É –∏–ª–∏ –∫ —Å—Ç–∞—Ä–æ–º—É –º–æ—Å—Ç—É. "
            "–ö—É–¥–∞ —Å—Ç—É–ø–∏—à—å?\""
        )

    # üîú –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å API):
    # headers = {
    #     "Authorization": f"Bearer {DEEPSEEK_API_KEY}",
    #     "Content-Type": "application/json"
    # }
    # data = {
    #     "model": "deepseek-chat",
    #     "messages": [
    #         {"role": "system", "content": "–¢—ã ‚Äî –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞—Ç–µ–ª—å –≤ —Ñ—ç–Ω—Ç–µ–∑–∏-–º–∏—Ä–µ. –û–ø–∏—Å—ã–≤–∞–π –º–∏—Ä, —Ä–µ–∞–≥–∏—Ä—É–π –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞ –∂–∏–≤–æ, –¥–µ—Ç–∞–ª—å–Ω–æ, —Å –¥—Ä–∞–º–∞—Ç–∏–∑–º–æ–º."},
    #         {"role": "user", "content": f"–ö–æ–Ω—Ç–µ–∫—Å—Ç: {context}\n–î–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞: {user_prompt}"}
    #     ],
    #     "temperature": 0.8
    # }
    # try:
    #     response = requests.post(DEEPSEEK_API_URL, headers=headers, json=data, timeout=30)
    #     response.raise_for_status()
    #     return response.json()["choices"][0]["message"]["content"].strip()
    # except Exception as e:
    #     return f"üßô‚Äç‚ôÇÔ∏è *–û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ –ò–ò:* {str(e)}"

    # –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É:
    return (
        f"üßô‚Äç‚ôÇÔ∏è *–ì–æ–ª–æ—Å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞—Ç–µ–ª—è:*\n"
        f"¬´{user_prompt}¬ª ‚Äî —ç—Ö–æ–º –ø—Ä–æ–∫–∞—Ç–∏–ª–æ—Å—å –ø–æ –∑–µ–º–ª–µ.\n"
        "–í –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –∑–µ–º–ª—è –¥—Ä–æ–≥–Ω—É–ª–∞... –ò–∑-–∑–∞ —Ö–æ–ª–º–∞ –ø–æ—è–≤–∏–ª—Å—è –≤–æ–ª–∫ —Å –≥–ª–∞–∑–∞–º–∏, –∫–∞–∫ —É–≥–ª–∏. "
        "–û–Ω —Ä—ã—á–∏—Ç, –Ω–æ –Ω–µ –Ω–∞–ø–∞–¥–∞–µ—Ç. –ß—Ç–æ —Å–¥–µ–ª–∞–µ—à—å?"
    )